<!--
    Project Title: Dine Together Calculator
    Code Name: DINE
    Code Color: 
    Code Hex: 
    Description:
    Start:
    Developer: Carl Angelo Nievarez
        > Github: https://github.com/aice09
        > Email: carlangelopamparonievarez@gmail.com
        > FB: https://facebook.com/aice0927
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dine Together Calculator | Aice0927</title> 
    <meta name="description" content="">
    <meta name="keywords" content=""> 
    <meta name="author" content="Carl Angelo Nievarez"> 
    <!--Favicon-->
    <link rel="apple-touch-icon" sizes="57x57" href="src/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="src/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="src/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="src/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="src/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="src/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="src/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="src/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="src/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="src/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="src/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="src/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="src/favicon/favicon-16x16.png">
    <link rel="manifest" href="src/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="src/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!--/////////////////////////////////////////////////////////////////////
                                SYSTEM STYLES
    /////////////////////////////////////////////////////////////////////-->
    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!--/////////////////////////////////////////////////////////////////////
                                SYSTEM SCRIPTS
    /////////////////////////////////////////////////////////////////////-->
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    <!-- bootstrap-select by silvio moreto -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>

    
    <script type="text/javascript"  src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.bootstrap.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.print.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.colVis.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.bootstrap.min.css">
</head>
<body>
    
    
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
        <a class="navbar-brand" href="#">Dine Together</a>
        </div>
    
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li>
                    <a  href="index.html">Home</a>
                  </li>
                  <li>
                      <a  href="beauty.html">Synergy</a>
                  </li>
                  <li>
                      <a  href="chefcalc.html">Chef</a>
                  </li>
                  <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Marketplace <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      <li><a href="marketplace-chef.html">Chef</a></li>
                      <li><a href="#">Furniture</a></li>
                      <li><a href="#">Land</a></li>
                      <li><a href="#">Card</a></li>
                    </ul>
                  </li>
                  <li>
                      <a  href="dishes.html">Dishes</a>
                  </li>
                  <li>
                      <a  href="https://docs.google.com/spreadsheets/d/19nZOIeE1D6FM4OhFSC272TaGPaR9um1LSVKTJj7cl2I/edit?usp=sharing">Spreadsheet</a>
                  </li>
                  <li>
                      <a  href="tip.html">Donate</a>
                  </li>
            </ul>
            <form class="navbar-form navbar-right" role="search">
                
            <a href="https://www.buymeacoffee.com/aice0927" class="donate-btn" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 40px !important;width: 150px !important;" ></a>
            <a class="btn btn-primary my-2 my-sm-0 donate-btn" href="tip.html" ><i class="fas fa-donate"></i> TIP me! </a>
            <a class="btn btn-success my-2 my-sm-0" href="https://dinetogether.io/" >Official Website <i class="fas fa-arrow-circle-right"></i> </a>
            </form>
           <!--  <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Link</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </li>
            </ul> -->
        </div><!-- /.navbar-collapse -->
    </nav>
    <div class="container wrapper">
        <div class="row" >  
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <!--breadcrumbs-->                
                <ol class="breadcrumb">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li class="active">Marketplace Chef</li>
                </ol>
                
            </div>          
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <h1>Marketplace Chef</h1>
                <small>Note: The buy button will redirect to official website.</small>
                <br>
            </div>           
            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 filterDiv">
                <!--filters--> 
                  
                <form action="" method="POST" role="form">              
                    <div class="form-group">
                        <label for="">Number of Rows</label>
                        <input type="text" class="form-control" id="rowLimit" placeholder="Number of Rows">
                    </div>
                    <div class="form-group">
                        <label for="">Sort By</label>
                        <select class="form-control selectpicker" id="sortBy" >
                            <option value="lowestPrice" >Lowest Price</option>
                            <option value="highestPrice" >Highest Price</option>
                            <option value="lowestId" >Lowest Id</option>
                            <option value="hightestId" >Highest Id</option>
                            <option value="latest" selected >Latest</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="">Duration</label>
                        <select class="form-control selectpicker" id="durationBy">
                            <option value="ALL" >All</option>
                            <option value="FULL" >Full Duration</option>
                            <option value="USED" >Used</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="">Rarity</label>
                        <select class="form-control selectpicker" id="rarity" multiple >
                            <option value="Apprentice" >Apprentice</option>
                            <option value="JuniorChef" >Junior Chef</option>
                            <option value="HeadChef" >Head Chef</option>
                            <option value="MasterChef" >Master Chef</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="">Min TIP</label>
                        <input type="text" class="form-control" id="minTip" placeholder="minTip">
                    </div>
                    <div class="form-group">
                        <label for="">Max TIP</label>
                        <input type="text" class="form-control" id="maxTip" placeholder="maxTip">
                    </div>
                    <div class="form-group">
                        <label for="">Food</label>
                        <select id="foodMenu" class="form-control" multiple >
                        </select>
                    </div>                
                    <div class="form-group">
                        <label for="">NFT ID</label>
                        <input type="text" class="form-control" id="ctNFTId" placeholder="NFT ID">
                    </div>
                    <!--Add button to clear filter-->
                    <button type="button" class="btn btn-success btn-block" id="clearFilter">Clear Filter</button>
                </form>
                  
            </div>               
            <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
                <table id="example" class="table table-striped table-bordered display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Chef ID</th>
                            <th>Image</th>
                            <th>Rarity</th>
                            <th>Menu</th>
                            <th>TIP</th>
                            <th>MP Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>No</th>
                            <th>Chef ID</th>
                            <th>Image</th>
                            <th>Rarity</th>
                            <th>Menu</th>
                            <th>TIP</th>
                            <th>MP Price</th>
                            <th>Action</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
        </div>
    </div>     
    <br><br>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <hr>
        <!--Copyright-->
        <div class="footer-copyright text-center">
            <div class="container-fluid">
                &copy;  2021 <a href="https://linktr.ee/aice0927">. Carl Angelo Nievarez | <b>Chef aice0927#0620</b> </a>
            </div>
        </div>
    </div>    
    <br><br>
</body> 
</html>
<script>
    $(document).ready(function() {   

        $.ajax({
            url: "https://backend-marketplace.dinetogether.io/v1/dish",
            dataType: 'json',
        }).done(function (response) {
            // add data to select menu
            var data = response.results
            //get data code and add to array
            var code = [];
            for (var i = 0; i < data.length; i++) {
                code.push(data[i].Code)
            }
            //add code to select menu
            for (var i = 0; i < code.length; i++) {
                $('#foodMenu').append('<option value="' + code[i] + '">' + code[i] + '</option>')
            }
            $('#foodMenu').selectpicker('render');
        });
        
        //get the value of sortBy
        var sortBy = $('#sortBy').val();
        var durationBy = $('#durationBy').val();
        var rarity = $('#rarity').val();
        var foodMenu = $('#foodMenu').val();
        var minTip = $('#minTip').val();
        var maxTip = $('#maxTip').val();
        var ctNFTId = $('#ctNFTId').val();
        var rowLimit = $('#rowLimit').val();        
        var page = 1;
        
        //if sortBy is empty, set default value
        if (sortBy == "") {
            sortBy = "latest";
        }

        //if durationBy is empty, set default value
        if (durationBy == "") {
            durationBy = "ALL";
        }

        //if rarity is empty, set default value
        if (rarity == "") {
            rarity = "Apprentice,JuniorChef,HeadChef,MasterChef";
        }

        //if foodMenu is empty, set default value
        if (foodMenu == "") {
            foodMenu = 'BEEFSTEAK,BIBIMBAP,BURGER,CHILLI_CRAB,CHOCOLATE,COCKTAIL,CURRY,FISH_N_CHIP,HOT_POT,ICE_CREAM,MOZZARELLA,PAELLA,PHO,PIZZA,RAMEN,SALAD,TOM_YUM,TOFU,TACOS,SUSHI';
        }

        //if mintip is empty, set it to 0
        if(minTip == ''){
            minTip = 0;
        }

        //if maxtip is empty, set it to 0
        if(maxTip == ''){
            maxTip = 100000;
        }
        
        //if rowLimit is empty, set it to 10
        if(rowLimit == ''){
            rowLimit = 10;
        }

        //on text input , get the value of sortBy
        $('#sortBy').on('change', function() {
            sortBy = $('#sortBy').val();
            if(sortBy == ''){
                sortBy = 'latest';
            }
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of durationBy
        $('#durationBy').change(function(){
            durationBy = $('#durationBy').val();
            if(durationBy == ''){
                durationBy = 'ALL';
            }
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of rarity
        $('#rarity').change(function(){
            raritySelect = $('#rarity').val();
            //rarity is empty
            if(raritySelect == ''){
                rarity = 'Apprentice,JuniorChef,HeadChef,MasterChef';
            } else {
                //get the value of rarity and add to array
                var rarityArray = [];

                for (var i = 0; i < raritySelect.length; i++) {
                    rarityArray.push(raritySelect[i])
                }

                //add rarity to string
                var rarity = rarityArray.join(',');
            }
            
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of foodMenu
        $('#foodMenu').change(function(){
            foodMenuSelect = $('#foodMenu').val();
            //foodMenu is empty
            if(foodMenuSelect == ''){
                foodMenu = 'BEEFSTEAK,BIBIMBAP,BURGER,CHILLI_CRAB,CHOCOLATE,COCKTAIL,CURRY,FISH_N_CHIP,HOT_POT,ICE_CREAM,MOZZARELLA,PAELLA,PHO,PIZZA,RAMEN,SALAD,TOM_YUM,TOFU,TACOS,SUSHI';
            } else {
                //get the value of foodMenu and add to array
                var foodMenuArray = [];

                for (var i = 0; i < foodMenuSelect.length; i++) {
                    foodMenuArray.push(foodMenuSelect[i])
                }

                //add foodMenu to string
                var foodMenu = foodMenuArray.join(',');
            }
           /*  var foodMenu = '';
            for (var i = 0; i < foodMenuSelect.length; i++) {
                foodMenuArray.push(foodMenuSelect[i])
            }
            //add foodMenu to string
            for (var i = 0; i < foodMenuArray.length; i++) {
                foodMenu += foodMenuArray[i] + ',';
            } */
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of minTip
        $('#minTip').change(function(){
            minTip = $('#minTip').val();
            if(minTip == ''){
                minTip = 0;
            }
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of maxTip
        $('#maxTip').change(function(){
            maxTip = $('#maxTip').val();
            if(maxTip == ''){
                maxTip = 10000;
            }
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of ctNFTId
        $('#ctNFTId').change(function(){
            ctNFTId = $('#ctNFTId').val();
            if(ctNFTId == ''){
                ctNFTId = '';
            }
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //onchange of rowLimit
        $('#rowLimit').change(function(){
            rowLimit = $('#rowLimit').val();
            if(rowLimit == ''){
                rowLimit = 10;
            }
            
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });


        //add function to clear filter
        $('#clearFilter').click(function(){
            $("#sortBy").val('default').selectpicker("refresh");
            $("#durationBy").val('default').selectpicker("refresh");
            $("#rarity").val('default').selectpicker("refresh");
            $("#foodMenu").val('default').selectpicker("refresh");
            $('#minTip').val('');
            $('#maxTip').val('');
            $('#ctNFTId').val('');
            $('#rowLimit').val('');
            sortBy = 'latest';
            durationBy = 'ALL';
            rarity = 'Apprentice,JuniorChef,HeadChef,MasterChef';
            foodMenu = 'BEEFSTEAK,BIBIMBAP,BURGER,CHILLI_CRAB,CHOCOLATE,COCKTAIL,CURRY,FISH_N_CHIP,HOT_POT,ICE_CREAM,MOZZARELLA,PAELLA,PHO,PIZZA,RAMEN,SALAD,TOM_YUM,TOFU,TACOS,SUSHI';
            minTip = 0;
            maxTip = 100000;
            ctNFTId = '';
            rowLimit = 10
            getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        });

        //add function getData
        function getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page){
           
            //if nftid is empty or null, make it null else remove ctNFTId in data array
            if(ctNFTId == '' || ctNFTId == null){

                //add all data into data array for ajax data
                var data = {
                    sort: sortBy,
                    duration: durationBy,
                    rarity: rarity,
                    menu: foodMenu,
                    minTip: minTip,
                    maxTip: maxTip,
                    limit: rowLimit,
                    page: page
                };
            } else {
                //add all data into data array for ajax data
                var data = {
                    sort: sortBy,
                    duration: durationBy,
                    rarity: rarity,
                    menu: foodMenu,
                    minTip: minTip,
                    maxTip: maxTip,
                    ctNFTId: ctNFTId,
                    limit: rowLimit,
                    page: page
                };
            }

            $.ajax({
                url: 'https://backend-marketplace.dinetogether.io/v1/chef',
                type: 'GET',
                data: data,
                dataType: 'json',
                success: function(response){
                    console.log(response);
                    var data = response.results;
                    var table = $('#example').DataTable({
                        data: data,
                        destroy : true, 
                        columns: [
                            { data: 'ctNFTId' },
                            { data: 'ctNFTId' },
                            { data: function ( data, type, row, meta ) {
                            return type === 'display'  ?
                                '<img width="100px" src="https://dine-static.s3.ap-southeast-1.amazonaws.com/chef/'+data.entity.head+'_'+data.entity.body+'.png" alt= >' :
                                data;
                            }},
                            { data: 'entity.rarity' },
                            //foreach inside array
                            { data: function ( data, type, row, meta ) {   
                                var menu = '<table class="table table-bordered"><thead><tr><th>Dish</th><th>Cook</th><th>TIP</th></tr></thead><tbody>';
                                $.each(data.entity.menu, function(index, value){
                                    menu += '<tr><td>'+value.code+'</td><td>'+value.numberCookRemain+'/'+ value.numberCookInit+'</td><td>'+value.tipAmount+'</td></tr>';
                                });
                                menu += '</tbody></table>';
                                return menu;
                            }},
                            { data: 'tipAmount' },
                            { data: 'endingPrice' },
                            { data: 'ctNFTId' , render : function ( data, type, row, meta ) {
                            return type === 'display'  ?
                                '<a href="https://marketplace.dinetogether.io/#/chef/'+ data +'" target="_blank" class="btn btn-primary" >Buy Now</a>' :
                                data;
                            }},
                        ],
                        //order: [[ 1, "asc" ]],
                        paging: false,    
                        scrollX: false,                
                        lengthChange: false,
                        buttons: [ 'copy', 'excel', 'pdf', 'colvis' ],
                        columnDefs: [ {
                            "searchable": false,
                            "orderable": false,
                            "targets": 0
                        },{
                            "searchable": false,
                            "orderable": false,
                            "targets": 4
                        } ]
                    });

                    //autoincrement
                    table.on( 'order.dt search.dt', function () {
                        table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                            cell.innerHTML = i + 1;
                            table.cell(cell).invalidate('dom'); 
                        } );
                    } ).draw();

                    table.buttons().container()
                        .appendTo( '#example_wrapper .col-sm-6:eq(0)' );
                }         
            }); 
            
        }

        //onpage load getData
        getData(sortBy, durationBy, rarity, foodMenu, minTip, maxTip, ctNFTId, rowLimit, page);
        
    } );
</script>
<style>
    .wrapper {
        margin-top: 70px;
    }
    .filterDiv {
        margin-bottom: 20px;
    }
</style>