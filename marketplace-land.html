<!--
    Project Title: Dine Together Calculator
    Code Name: DINE
    Code Color: 
    Code Hex: 
    Description:
    Start:
    Developer: Carl Angelo Nievarez
        > Github: https://github.com/aice09
        > Email: carlangelopamparonievarez@gmail.com
        > FB: https://facebook.com/aice0927
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dine Together Calculator | Aice0927</title> 
    <meta name="description" content="">
    <meta name="keywords" content=""> 
    <meta name="author" content="Carl Angelo Nievarez"> 
    <!--Favicon-->
    <link rel="apple-touch-icon" sizes="57x57" href="src/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="src/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="src/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="src/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="src/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="src/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="src/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="src/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="src/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="src/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="src/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="src/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="src/favicon/favicon-16x16.png">
    <link rel="manifest" href="src/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="src/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!--/////////////////////////////////////////////////////////////////////
                                SYSTEM STYLES
    /////////////////////////////////////////////////////////////////////-->
    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!--/////////////////////////////////////////////////////////////////////
                                SYSTEM SCRIPTS
    /////////////////////////////////////////////////////////////////////-->
    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    <!-- bootstrap-select by silvio moreto -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>

    
    <script type="text/javascript"  src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.bootstrap.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.print.min.js"></script>
    <script type="text/javascript"  src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.colVis.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.bootstrap.min.css">
</head>
<body>
    
    
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
        <a class="navbar-brand" href="#">Dine Together</a>
        </div>
    
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li>
                    <a  href="index.html">Home</a>
                  </li>
                  <li>
                      <a  href="beauty.html">Synergy</a>
                  </li>
                  <li>
                      <a  href="chefcalc.html">Chef</a>
                  </li>
                  <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Marketplace <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      <li><a href="marketplace-chef.html">Chef</a></li>
                      <li><a href="#">Furniture</a></li>
                      <li><a href="marketplace-land.html">Land</a></li>
                      <li><a href="#">Card</a></li>
                    </ul>
                  </li>
                  <li>
                      <a  href="dishes.html">Dishes</a>
                  </li>
                  <li>
                      <a  href="https://docs.google.com/spreadsheets/d/19nZOIeE1D6FM4OhFSC272TaGPaR9um1LSVKTJj7cl2I/edit?usp=sharing">Spreadsheet</a>
                  </li>
                  <li>
                      <a  href="tip.html">Donate</a>
                  </li>
            </ul>
            <form class="navbar-form navbar-right" role="search">
                
            <a href="https://www.buymeacoffee.com/aice0927" class="donate-btn" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 40px !important;width: 150px !important;" ></a>
            <a class="btn btn-primary my-2 my-sm-0 donate-btn" href="tip.html" ><i class="fas fa-donate"></i> TIP me! </a>
            <a class="btn btn-success my-2 my-sm-0" href="https://dinetogether.io/" >Official Website <i class="fas fa-arrow-circle-right"></i> </a>
            </form>
           <!--  <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Link</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li><a href="#">Separated link</a></li>
                    </ul>
                </li>
            </ul> -->
        </div><!-- /.navbar-collapse -->
    </nav>
    <div class="container wrapper">
        <div class="row" >  
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <!--breadcrumbs-->                
                <ol class="breadcrumb">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li class="active">Marketplace Land</li>
                </ol>
                
            </div>          
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <h1>Marketplace Land</h1>
                <small>Note: The buy button will redirect to official website.</small>
                <br>
            </div>           
            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 filterDiv">
                <!--filters--> 
                  
                <form action="" method="POST" role="form">              
                    <div class="form-group">
                        <label for="">Number of Rows</label>
                        <input type="text" class="form-control" id="rowLimit" placeholder="Number of Rows">
                    </div>
                    <div class="form-group">
                        <label for="">Sort By</label>
                        <select class="form-control selectpicker" id="sortBy" >
                            <option value="lowestPrice" >Lowest Price</option>
                            <option value="highestPrice" >Highest Price</option>
                            <option value="lowestId" >Lowest Id</option>
                            <option value="hightestId" >Highest Id</option>
                            <option value="latest" selected >Latest</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="">Homeland</label>
                        <select class="form-control selectpicker" id="faction" multiple >
                            <option value="Asgard" >Asgard</option>
                            <option value="Camelot" >Camelot</option>
                            <option value="ElDorado" >ElDorado</option>
                            <option value="Olympus" >Olympus</option>
                            <option value="ShangriLa" >ShangriLa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="">Location X</label>
                        <input type="text" class="form-control" id="locationX" placeholder="locationX">
                    </div>
                    <div class="form-group">
                        <label for="">Location Y</label>
                        <input type="text" class="form-control" id="locationY" placeholder="locationY">
                    </div>             
                    <div class="form-group">
                        <label for="">NFT ID</label>
                        <input type="text" class="form-control" id="ctNFTId" placeholder="NFT ID">
                    </div>
                    <!--Add button to clear filter-->
                    <button type="button" class="btn btn-success btn-block" id="clearFilter">Clear Filter</button>
                </form>
                  
            </div>               
            <div class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
                <table id="example" class="table table-striped table-bordered display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Chef ID</th>
                            <th>Image</th>
                            <th>Homeland</th>
                            <th>Coordinates</th>
                            <th>MP Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>No</th>
                            <th>Chef ID</th>
                            <th>Image</th>
                            <th>Homeland</th>
                            <th>Coordinates</th>
                            <th>MP Price</th>
                            <th>Action</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
        </div>
    </div>     
    <br><br>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <hr>
        <!--Copyright-->
        <div class="footer-copyright text-center">
            <div class="container-fluid">
                &copy;  2021 <a href="https://linktr.ee/aice0927">. Carl Angelo Nievarez | <b>Chef aice0927#0620</b> </a>
            </div>
        </div>
    </div>    
    <br><br>
</body> 
</html>
<script>
    $(document).ready(function() { 

        //get the value of sortBy
        var sortBy = $('#sortBy').val();
        var locationX = $('#locationX').val();
        var locationY = $('#locationY').val();
        var faction = $('#faction').val();
        var ctNFTId = $('#ctNFTId').val();
        var rowLimit = $('#rowLimit').val();        
        var page = 1;
        
        //if sortBy is empty, set default value
        if (sortBy == "") {
            sortBy = "latest";
        }

        //if foodMenu is empty, set default value
        if (faction == "") {
            faction = 'Camelot,Asgard,Olympus,ElDorado,ShangriLa';
        }
        
        //if rowLimit is empty, set it to 10
        if(rowLimit == ''){
            rowLimit = 10;
        }

        //if locationX is empty, set it to 0
        if(locationX == ''){
            locationX = null;
        }

        //if locationY is empty, set it to 0
        if(locationY == ''){
            locationX = null;
        }

        //on text input , get the value of sortBy
        $('#sortBy').on('change', function() {
            sortBy = $('#sortBy').val();
            if(sortBy == ''){
                sortBy = 'latest';
            }
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
        });

        //onchange of rarity
        $('#faction').change(function(){
            factionSelect = $('#faction').val();
            //faction is empty
            if(factionSelect == ''){
                faction = 'Camelot,Asgard,Olympus,ElDorado,ShangriLa';
            } else {
                //get the value of rarity and add to array
                var factionArray = [];

                for (var i = 0; i < factionSelect.length; i++) {
                    factionArray.push(factionSelect[i])
                }

                //add rarity to string
                var faction = factionArray.join(',');
            }
            
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
        });

        

        //onchange of minTip
        $('#locationX').change(function(){
            locationX = $('#locationX').val();
            if(locationX == ''){
                locationX = null;
            }
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
                       
        });

        //onchange of maxTip
        $('#locationY').change(function(){
            locationY = $('#locationY').val();
            if(locationY == ''){
                locationY = null;
            }
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
        });

        //onchange of ctNFTId
        $('#ctNFTId').change(function(){
            ctNFTId = $('#ctNFTId').val();
            alert(ctNFTId);
            if(ctNFTId == ''){
                ctNFTId = '';
            }
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
            
        });

        //onchange of rowLimit
        $('#rowLimit').change(function(){
            rowLimit = $('#rowLimit').val();
            if(rowLimit == ''){
                rowLimit = 10;
            }
            
            getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy);
        });


       
        //add function getData
        function getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy){
            
            
            //if nftid is empty or null, make it null else remove ctNFTId in data array
            if(ctNFTId == '' || ctNFTId == null /* || locationX == '' || locationY == '' || locationX == null || locationY == null */){

                //if location is empty or null, make it null else remove location in data array


                //add all data into data array for ajax data
                /* var data = {
                    'locationX': locationX,
                    'locationY': locationY,
                    'faction': faction,
                    'limit': rowLimit,
                    'page': page,
                    'sort': sortBy
                }; */
                if(locationX == '' || locationY == '' || locationX == null || locationY == null){

                //if location is empty or null, make it null else remove location in data array


                //add all data into data array for ajax data
                var data = {
                    'faction': faction,
                    'limit': rowLimit,
                    'page': page,
                    'sort': sortBy
                };

                } else {
                //add all data into data array for ajax data
                var data = {
                    'locationX': locationX,
                    'locationY': locationY,
                    'faction': faction,
                    'limit': rowLimit,
                    'page': page,
                    'sort': sortBy
                };

                }

            } else {
                //add all data into data array for ajax data
                /* var data = {
                    'locationX': locationX,
                    'locationY': locationY,
                    'faction': faction,
                    'ctNFTId': ctNFTId,
                    'limit': rowLimit,
                    'page': page,
                    'sort': sortBy
                }; */

                if(locationX == '' || locationY == '' || locationX == null || locationY == null){

                    //if location is empty or null, make it null else remove location in data array


                    //add all data into data array for ajax data
                    var data = {
                        'faction': faction,
                        'limit': rowLimit,
                        'ctNFTId': ctNFTId,
                        'page': page,
                        'sort': sortBy
                    };

                    } else {
                    //add all data into data array for ajax data
                    var data = {
                        'locationX': locationX,
                        'locationY': locationY,
                        'faction': faction,
                        'ctNFTId': ctNFTId,
                        'limit': rowLimit,
                        'page': page,
                        'sort': sortBy
                    };

                }
                
            }

            //https://backend-marketplace.dinetogether.io/v1/land?faction=Camelot,Asgard,Olympus,ElDorado,ShangriLa&locationX=68&locationY=9&page=1&limit=10&ctNFTId=1686&sort=lowestPrice
            $.ajax({
                url: 'https://backend-marketplace.dinetogether.io/v1/land',
                type: 'GET',
                data: data,
                dataType: 'json',
                success: function(response){
                    console.log(response);
                    var data = response.results;
                    var table = $('#example').DataTable({
                        data: data,
                        destroy : true, 
                        columns: [
                            { data: 'ctNFTId' },
                            { data: 'ctNFTId' },
                            { data: function ( data, type, row, meta ) {
                            return type === 'display'  ?
                                '<img width="100px" src="https://marketplace.dinetogether.io/_nuxt/img/land-large.ee478c6.png" alt= >' :
                                data;
                            }},
                            { data: 'entity.faction' }, 
                            { data: function ( data, type, row, meta ) {   
                                var menu = '<table class="table table-bordered"><thead><tr><th>LocationX</th><th>LocationY</th></tr></thead><tbody>';
                                    //get array of locationX and locationY
                                    var locationX = data.entity.pos[0];
                                    var locationY = data.entity.pos[1];
                                    menu += '<tr><td>'+locationX +'</td><td>'+locationY+'</td></tr>';
                                
                                menu += '</tbody></table>';
                                return menu;
                            }},                      /*      
                            { data: 'entity.pos.0' },                            
                            { data: 'entity.pos.1' },         */                    
                            { data: 'endingPrice' },
                            { data: 'ctNFTId' , render : function ( data, type, row, meta ) {
                            return type === 'display'  ?
                                '<a href="https://marketplace.dinetogether.io/#/land/'+ data +'" target="_blank" class="btn btn-primary" >Buy Now</a>' :
                                data;
                            }},
                        ],
                        //order: [[ 1, "asc" ]],
                        paging: false,    
                        scrollX: false,                
                        lengthChange: false,
                        buttons: [ 'copy', 'excel', 'pdf', 'colvis' ],
                        columnDefs: [ {
                            "searchable": false,
                            "orderable": false,
                            "targets": 2
                        },{
                            "searchable": false,
                            "orderable": false,
                            "targets": 4
                        } ]
                    });

                    //autoincrement
                    table.on( 'order.dt search.dt', function () {
                        table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                            cell.innerHTML = i + 1;
                            table.cell(cell).invalidate('dom'); 
                        } );
                    } ).draw();

                    table.buttons().container()
                        .appendTo( '#example_wrapper .col-sm-6:eq(0)' );
                }         
            }); 
            
        }

        //onpage load getData
        getData(locationX, locationY, faction, ctNFTId, rowLimit, page,sortBy)
        
    } );
</script>
<style>
    .wrapper {
        margin-top: 70px;
    }
    .filterDiv {
        margin-bottom: 20px;
    }
</style>